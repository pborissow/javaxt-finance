if(!javaxt)var javaxt={};if(!javaxt.dhtml)javaxt.dhtml={};
if(!javaxt)var javaxt={};if(!javaxt.express)javaxt.express={};if(!javaxt.express.app)javaxt.express.app={};javaxt.express.app.Horizon=function(parent,config){this.className="javaxt.express.app.Horizon";var me=this;var defaultConfig={name:"Express",style:{javaxt:javaxt.dhtml.style.default,header:{div:"app-header",icon:"app-header-icon noselect",profileButton:"app-header-profile noselect",menuButton:"app-header-menu noselect",menuPopup:"app-menu",menuItem:"app-menu-item noselect"},navbar:{div:"app-nav-bar",tabs:"app-tab-container"},body:{div:"app-body"},footer:{div:"app-footer"},communicationError:{div:"communication-error center",icon:"communication-error-icon",title:"title",message:"message",closeButton:"close"}},url:{login:"login",logoff:"logoff",websocket:"/ws"},keywords:{requestedTab:"tab"},autoLogoff:false,useBrowserHistory:false,windows:[],renderers:{profileButton:function(user,profileButton){}},messages:{connectionLost:"The connection to the server has been lost. "+"The internet might be down or there might be a problem with the server. "+"Some features might not work as expected while the server is offline. "+"Please do not refresh your browser. We will try to reconnect in a few moments.",connectionTimeout:"We have lost contact with the server. "+"It has been unavailable for over 5 minutes. Please check your "+"internet connection or contact the system administrator for assistance.",updateAvailable:"An update is available for this application. "+"Would you like to update now?"}};var waitmask;var auth;var currUser;var ws;var connected=false;var communicationError;var timeoutWarning;var profileButton,menuButton;var mainMenu,profileMenu;var callout;var tabbar,body,footer;var tabs={};var panels={};var timers={};var userInteractions=["mousemove","click","keydown","touchmove","wheel"];var init=function(){if(!config)config={};config=merge(config,defaultConfig);auth=new javaxt.dhtml.Authentication(config.url.login,config.url.logoff);if(!config.fx)config.fx=new javaxt.dhtml.Effects();if(!config.waitmask||!config.waitmask.el.parentNode)
config.waitmask=new javaxt.express.WaitMask(document.body);waitmask=config.waitmask;document.addEventListener("keydown",function(e){if((e.keyCode==65||e.keyCode==72||e.keyCode==79||e.keyCode==80||e.keyCode==83)&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)){e.preventDefault();e.stopPropagation();}});var table=createTable(parent);createHeader(table.addRow().addColumn(config.style.header.div));var td=table.addRow().addColumn(config.style.navbar.div);tabbar=createElement("div",td,config.style.navbar.tabs);body=table.addRow().addColumn(config.style.body.div);body.style.height="100%";footer=table.addRow().addColumn(config.style.footer.div);me.el=table;};this.update=function(user,tabs){document.title=config.name;updateTabs(tabs);var prevUserID=currUser?currUser.id:null;updateUser(user);if(user.id===prevUserID)return;enablePopstateListener();enableEventListeners();if(config.autoLogoff&&config.autoLogoff>0){timers.logoff=setTimeout(me.logoff,config.autoLogoff);}
if(!ws)ws=new javaxt.dhtml.WebSocket({url:config.url.websocket,onMessage:function(msg){try{me.onMessage(msg);}
catch(e){}
var arr=msg.split(",");var op=arr[0];var model=arr[1];var id=arr[2];var userID=arr[3];var n=id+"";var isNumber=!isNaN(parseFloat(n))&&!isNaN(n-0);if(isNumber){try{var i=parseInt(id);if(!isNaN(i))id=i;}
catch(e){}}
try{userID=parseInt(userID);}catch(e){}
processEvent(op,model,id,userID);},onConnect:function(){if(!connected){connected=true;processEvent("connect","WebSocket",-1,-1);}},onDisconnect:function(){if(connected){connected=false;processEvent("disconnect","WebSocket",-1,-1);}},onTimeout:function(){connected=false;if(communicationError)communicationError.hide(true);if(!timeoutWarning)createTimeoutWarning();timeoutWarning.show();}});};this.getTabs=function(){var arr=[];for(var key in tabs){if(tabs.hasOwnProperty(key)){arr.push({name:key,tab:tabs[key],panel:panels[key]});}}
return arr;};this.getTab=function(name){var tab=tabs[name];if(!tab)return null;return{name:name,tab:tab,panel:panels[name]};};this.beforeTabChange=function(currTab,nextTab){};this.onTabChange=function(currTab){};this.sendMessage=function(msg){if(ws)ws.send(msg);};this.onMessage=function(msg){};this.onModelChangeEvent=function(op,model,id,userID){};this.onLogOff=function(){};this.onUserInteration=function(e){};var onUserInteration=function(e){me.onUserInteration(e);if(timers.logoff){clearTimeout(timers.logoff);timers.logoff=setTimeout(me.logoff,config.autoLogoff);};};var enableEventListeners=function(){userInteractions.forEach((interaction)=>{document.body.addEventListener(interaction,onUserInteration);});};var disableEventListeners=function(){userInteractions.forEach((interaction)=>{document.body.removeEventListener(interaction,onUserInteration);});};var updateUser=function(user){currUser=user;if(user)profileButton.show();if(config.renderers.profileButton){config.renderers.profileButton(user,profileButton);}
var currTab,requestedTab;var t=getParameter(config.keywords.requestedTab).toLowerCase();for(var key in tabs){if(tabs.hasOwnProperty(key)){var tab=tabs[key];if(tab.isVisible()){if(tab.className==="active"){currTab=key;}
if(key.toLowerCase()===t){requestedTab=key;}}}}
user.preferences=new javaxt.express.UserPreferences(()=>{if(requestedTab){var url=window.location.href;url=url.replace("tab="+getParameter(config.keywords.requestedTab),"");if(url.lastIndexOf("&")===url.length-1)url=url.substring(0,url.length-1);if(url.lastIndexOf("?")===url.length-1)url=url.substring(0,url.length-1);me.updateHistory({title:config.name+" - "+requestedTab,tab:requestedTab,url:url});tabs[requestedTab].raise();}
else{if(!currTab)currTab=user.preferences.get("Tab");if(currTab&&tabs[currTab]){me.updateHistory({title:config.name+" - "+currTab,tab:currTab});tabs[currTab].raise();}
else{for(var tabLabel in tabs){if(tabs.hasOwnProperty(tabLabel)){me.updateHistory({title:config.name+" - "+tabLabel,tab:tabLabel});tabs[tabLabel].raise();break;}}}}});};var processEvent=function(op,model,id,userID){if(model==="WebSocket"){if(currUser){if(op==="connect"){if(communicationError)communicationError.hide();if(timeoutWarning)timeoutWarning.close();menuButton.hideMessage();}
else{if(!communicationError)createErrorMessage();communicationError.show();}}
else{}}
else if(model==="WebFile"){if(currUser&&currUser.preferences){var autoReload=currUser.preferences.get("AutoReload");if(autoReload===true||autoReload==="true"){location.reload();}
else{me.el.style.filter="blur(3px)";confirm({width:515,resizable:false,title:"Update Available",text:config.messages.updateAvailable,leftButton:{label:"Yes",value:true},rightButton:{label:"No",value:false},callback:function(answer){if(answer===true)location.reload();else{me.el.style.filter="";menuButton.showMessage("Update Available");}}});}}}
else{me.onModelChangeEvent(op,model,id,userID);}
for(var key in panels){if(panels.hasOwnProperty(key)){var panel=panels[key];if(panel.notify)panel.notify(op,model,id,userID);}}};var createHeader=function(parent){var tr=createTable(parent).addRow();createElement("div",tr.addColumn(),config.style.header.icon);tr.addColumn().style.width="100%";createProfileButton(tr.addColumn());createMenuButton(tr.addColumn());};var updateTabs=function(obj){var newTabs={};if(obj){if(isArray(obj)){obj.forEach((tab)=>{if(tab.cls&&!tab.class)tab.class=tab.cls;if(typeof tab.class==='function'){newTabs[tab.name]=tab;}});}
else{for(var key in obj){if(obj.hasOwnProperty(key)){var cls=obj[key];if(typeof cls==='function'){newTabs[key]={class:cls};}}}}}
var activeTab;for(var key in tabs){if(tabs.hasOwnProperty(key)){var tab=tabs[key];if(tab.parentNode)tabbar.removeChild(tab);if(tab.className==="active"){activeTab=key;}}}
for(var key in newTabs){if(newTabs.hasOwnProperty(key)){if(tabs[key]){var tab=tabs[key];tabbar.appendChild(tab);tab.show();}
else{createTab(key,newTabs[key]);}}}
if(activeTab){if(newTabs[activeTab]){tabs[activeTab].className="active";var panel=panels[activeTab];if(panel)panel.show();}
else{tabs[activeTab].className="";var panel=panels[activeTab];if(panel)panel.hide();}}};var createTab=function(label,obj){if(tabs[label])return;var tab=createElement("div",tabbar);tab.innerText=label;var fn=function(){var panel=panels[label];Object.values(panels).forEach((p)=>{if(p===panel)return;p.hide();});if(panel){panel.show();}
else{var cfg;if(obj.config){cfg=obj.config;}
else{cfg={style:config.style.javaxt,fx:config.fx,waitmask:config.waitmask};for(var key in config){if(config.hasOwnProperty(key)){if(defaultConfig[key])continue;cfg[key]=config[key];}}}
var fn=eval(obj.class);panel=new fn(body,cfg);addShowHide(panel);panels[label]=panel;if(panel.update)panel.update();}};tab.raise=function(){if(this.className==="active")return;hideWindows();for(var i=0;i<tabbar.childNodes.length;i++){tabbar.childNodes[i].className="";}
this.className="active";fn.apply(me,[]);if(currUser)currUser.preferences.set("Tab",label);me.onTabChange({name:label,tab:this,panel:panels[label]});};tab.onclick=function(){if(this.className==="active")return;var currTab;for(var i=0;i<tabbar.childNodes.length;i++){var t=tabbar.childNodes[i];if(t.className==="active"){var l=t.innerText;currTab={name:l,tab:t,panel:panels[l]};break;}}
me.beforeTabChange(currTab,{name:label,tab:this,panel:panels[label]});me.addHistory({title:config.name+" - "+label,tab:label});this.raise();};tabs[label]=tab;addShowHide(tab);};this.addHistory=function(params){updateState(params,false);};this.updateHistory=function(params){updateState(params,true);};var updateState=function(params,replace){if(config.useBrowserHistory!==true)return;var title=params.title;if(!title)title=document.title;var url="";if(params.url){url=params.url;delete params.url;}
var state=window.history.state;if(!state)state={};state[me.className]=params;if(replace){document.title=title;history.replaceState(state,title,url);}
else{history.pushState(state,title,url);document.title=title;}};var enablePopstateListener=function(){disablePopstateListener();if(config.useBrowserHistory===true){window.addEventListener('popstate',popstateListener);var state=window.history.state;if(!state)state={};if(!state[me.className])state[me.className]={};history.replaceState(state,null,'');}};var disablePopstateListener=function(){window.removeEventListener('popstate',popstateListener);};var popstateListener=function(e){if(e.state[me.className]){var label=e.state[me.className].tab;var t=getParameter(config.keywords.requestedTab).toLowerCase();if(t&&t.length>0){if(t!==label.toLowerCase()){for(var key in tabs){if(tabs.hasOwnProperty(key)){var tab=tabs[key];if(tab.isVisible()){if(key.toLowerCase()===t){label=key;break;}}}}}}
var tab=tabs[label];if(tab)tab.raise();}};var createBody=function(parent){};var createFooter=function(parent){};var createMenuButton=function(parent){menuButton=createElement("div",parent,config.style.header.menuButton);menuButton.label=createElement("div",menuButton,"label");menuButton.icon=createElement("div",menuButton,"icon");menuButton.label.style.opacity=0;menuButton.showMessage=function(msg){if(!msg)msg="Warning";menuButton.classList.add("warning");menuButton.label.innerText=msg;menuButton.label.style.opacity=1;};menuButton.hideMessage=function(){menuButton.label.style.opacity=0;menuButton.label.style.display="none";menuButton.classList.remove("warning");setTimeout(()=>{menuButton.label.style.display="";menuButton.label.style.opacity=0;},500);};menuButton.onclick=function(e){if(currUser)showMenu(getMainMenu(),this);};addShowHide(menuButton);};var showMenu=function(menu,target){var numVisibleItems=0;for(var i=0;i<menu.childNodes.length;i++){var menuItem=menu.childNodes[i];if(menuItem.isVisible())numVisibleItems++;}
if(numVisibleItems===0){return;}
var callout=getCallout();var innerDiv=callout.getInnerDiv();while(innerDiv.firstChild){innerDiv.removeChild(innerDiv.lastChild);}
innerDiv.appendChild(menu);var rect=javaxt.dhtml.utils.getRect(target);var x=rect.x+(rect.width/2);var y=rect.y+rect.height+3;callout.showAt(x,y,"below","right");};var createProfileButton=function(parent){profileButton=createElement("div",parent,config.style.header.profileButton);profileButton.onclick=function(e){if(currUser)showMenu(getProfileMenu(),this);};addShowHide(profileButton);};var getProfileMenu=function(){if(!profileMenu){var div=createElement("div",config.style.header.menuPopup);div.appendChild(createMenuOption("Account Settings","edit",function(){console.log("Show Account");}));div.appendChild(createMenuOption("Sign Out","times",function(){me.logoff();}));profileMenu=div;}
return profileMenu;};var createMenuOption=function(label,icon,onClick){var div=createElement("div",config.style.header.menuItem);if(icon&&icon.length>0){div.innerHTML='<i class="fas fa-'+icon+'"></i>'+label;}
else{div.innerHTML=label;}
div.label=label;div.onclick=function(){callout.hide();onClick.apply(this,[label]);};addShowHide(div);return div;};var createErrorMessage=function(){var div=createElement("div",parent,{position:"absolute",top:"10px",width:"100%",height:"0px",display:"none"});var fx=config.fx;var transitionEffect="easeInBack";var duration=1000;var isVisible=false;div.show=function(){if(isVisible)return;isVisible=true;fx.fadeIn(div,transitionEffect,duration);};div.hide=function(nodelay){if(!isVisible)return;isVisible=false;if(nodelay===true)div.style.display="none";fx.fadeOut(div,transitionEffect,duration/2);};div.isVisible=function(){return isVisible;};var style=config.style.communicationError;var useClass=isString(style);var error=createElement("div",div,useClass?style:style.div);createElement("div",error,useClass?"icon":style.icon);createElement("div",error,useClass?"title":style.title).innerText="Connection Lost";createElement("div",error,useClass?"message":style.message).innerText=config.messages.connectionLost;var closeButton=createElement("div",error,useClass?"close":style.closeButton);closeButton.onclick=function(){div.hide(true);setTimeout(()=>{menuButton.showMessage("Offline");},500);};config.windows.push(div);communicationError=div;};var createTimeoutWarning=function(){timeoutWarning=new javaxt.dhtml.Window(document.body,{width:470,valign:"top",modal:true,title:"Warning",style:config.style.javaxt.window,buttons:[{name:"OK",onclick:function(){timeoutWarning.close();}}]});config.windows.push(timeoutWarning);var table=createTable(timeoutWarning.getBody());table.style.height="";var tr=table.addRow();var d=createElement("div",tr.addColumn({verticalAlign:"top"}),{padding:"3px 10px"});createElement("div",d,config.style.communicationError.icon);tr.addColumn({width:"100%"}).innerText=config.messages.connectionTimeout;timeoutWarning.onClose=function(){menuButton.showMessage("Offline");};timeoutWarning.onOpen=function(){if(communicationError)communicationError.hide();};};var hideWindows=function(){config.windows.forEach((window)=>{window.hide();});};this.logoff=function(){waitmask.show();currUser=null;document.title=config.name;if(config.useBrowserHistory===true){var state=window.history.state;if(!state)state={};var url=window.location.href;var idx=url.indexOf("?");if(idx>-1)url=url.substring(0,idx);history.replaceState(state,config.name,url);}
disableEventListeners();disablePopstateListener();if(ws){ws.stop();ws=null;}
for(var key in timers){if(timers.hasOwnProperty(key)){var timer=timers[key];clearTimeout(timer);}}
timers={};hideWindows();tabbar.innerHTML="";tabs={};for(var key in panels){if(panels.hasOwnProperty(key)){var panel=panels[key];if(panel.clear)panel.clear();destroy(panel);}}
panels={};menuButton.hideMessage();if(mainMenu){var parent=mainMenu.parentNode;if(parent)parent.removeChild(mainMenu);mainMenu=null;}
profileButton.hide();if(profileMenu){var parent=profileMenu.parentNode;if(parent)parent.removeChild(profileMenu);profileMenu=null;}
auth.logoff(function(){me.onLogOff();var pageLoader=new javaxt.dhtml.PageLoader();pageLoader.loadPage("index.html",function(){waitmask.hide();});});};var getCallout=function(){if(callout){var parent=callout.el.parentNode;if(!parent){callout.el.innerHTML="";callout=null;}}
if(!callout)callout=new javaxt.dhtml.Callout(document.body,{style:config.style.javaxt.callout});return callout;};var createElement=javaxt.dhtml.utils.createElement;var getParameter=javaxt.dhtml.utils.getParameter;var createTable=javaxt.dhtml.utils.createTable;var addShowHide=javaxt.dhtml.utils.addShowHide;var isString=javaxt.dhtml.utils.isString;var isArray=javaxt.dhtml.utils.isArray;var destroy=javaxt.dhtml.utils.destroy;var merge=javaxt.dhtml.utils.merge;init();};
if(!javaxt){var javaxt={}}if(!javaxt.express){javaxt.express={}}javaxt.express.WebSite=function(content,config){this.className="javaxt.express.WebSite";var me=this;var tabs;var carousel;var currPage,nextPage;var slideIndex;var defaultConfig={tabs:[],navbar:null,sidebar:null,minContentHeight:600,padding:20,animationSteps:600,fx:null,style:{panel:{background:"#fff",height:""}}};var pageLoader=new javaxt.dhtml.PageLoader();var scrollUp=false;var timer;var debug=false;var init=function(){var clone={};merge(clone,config);merge(clone,defaultConfig);config=clone;if(!config.fx){config.fx=new javaxt.dhtml.Effects()}tabs=config.tabs;var arr=[];for(var i=0;i<tabs.length;i++){var path=getPath(tabs[i].pathname);var dir=getDir(path);var div=tabs[i].getElementsByTagName("div")[0];arr.push({dir:dir,div:div})}tabs=arr;var path=getPath(window.location.pathname);me.updateTabs(path);me.updateNav(path);me.updateSidebar(path);var links=document.getElementsByTagName("a");me.updateLinks(links);if(typeof CodeMirror!=="undefined"){highlight(content)}else{if(typeof SyntaxHighlighter!=="undefined"){SyntaxHighlighter.defaults["class-name"]="code-block";SyntaxHighlighter.defaults.toolbar=false;SyntaxHighlighter.defaults.gutter=false;highlight(content)}}var contentHeight=content.offsetHeight;var minContentHeight=parseFloat(config.minContentHeight);if(!isNaN(minContentHeight)){contentHeight=Math.max(contentHeight,minContentHeight)}content.style.height=contentHeight+"px";currPage=document.createElement("div");currPage.style.height="100%";var contentWrapper=document.createElement("div");setStyle(contentWrapper,config.style.panel);currPage.appendChild(contentWrapper);while(content.childNodes.length>0){var node=content.childNodes[0];content.removeChild(node);contentWrapper.appendChild(node)}nextPage=document.createElement("div");nextPage.style.height="100%";carousel=new javaxt.dhtml.Carousel(content,{items:[currPage,nextPage],drag:false,loop:true,padding:config.padding,animationSteps:config.animationSteps,transitionEffect:"easeInOutCubic",fx:config.fx,onRender:function(){}});carousel.beforeChange=function(currPanel,nextPanel){currPanel.style.opacity=0;nextPanel.style.opacity=0;if(timer){clearInterval(timer)}updateContent(nextPanel);var path=getPath(window.location.pathname);me.updateTabs(path);me.updateNav(path);me.updateSidebar(path);dispatchEvent("beforeunload")};carousel.onChange=function(currPanel,prevPanel){currPage=currPanel;nextPage=prevPanel;if(config.fx){config.fx.fadeIn(currPanel,"easeInCubic",300)}else{currPanel.style.opacity=1}var resizeSteps=0;if(config.animationSteps>0){resizeSteps=100}if(scrollUp){scrollUp=false;if(getScrollPosition()>50&&resizeSteps>0){var animationSteps=1000;scrollTop(new Date().getTime(),animationSteps,animationSteps,function(){resize(currPanel,resizeSteps)})}else{setScrollPosition(0)}}timer=setInterval(function(){resize(currPanel,resizeSteps)},250);prevPanel.innerHTML="";dispatchEvent("load")};carousel.onResize=function(){dispatchEvent("resize")};window.addEventListener("resize",function(e){resize(currPage)});dispatchEvent("resize");window.addEventListener("popstate",popstateListener);log(window.history.state);if(window.history.state==null){slideIndex=0;var panelInfo={index:slideIndex,title:document.title};history.replaceState(panelInfo,null,"")}else{slideIndex=window.history.state.index}log("slideIndex: "+slideIndex)};var popstateListener=function(e){var panel=e.state;log(panel);document.title=panel.title;if(!nextPage){console.error("nextPage is null in popstateListener");return}var url=window.location;getHTML(url,function(html,title,inlineScripts){nextPage.innerHTML=html;loadInlineScripts(inlineScripts);if(slideIndex>=panel.index){carousel.back();slideIndex=panel.index}else{if(slideIndex<panel.index){carousel.next();slideIndex=panel.index}else{log(slideIndex+" vs "+panel.index)}}})};this.enablePopstateListener=function(){me.disablePopstateListener();window.addEventListener("popstate",popstateListener)};this.disablePopstateListener=function(){window.removeEventListener("popstate",popstateListener)};this.beforeResize=function(){};this.onResize=function(){};var resize=function(panel,animationSteps){var r1=_getRect(panel.parentNode);var firstChild=getFirstChild(panel);if(firstChild){panel=firstChild}var r2=_getRect(panel);var h=r2.height+(r2.top-r1.top);var contentHeight=parseFloat(content.style.height);var minContentHeight=parseFloat(config.minContentHeight);if(!isNaN(minContentHeight)){h=Math.max(h,minContentHeight)}if(h===contentHeight){return}else{me.beforeResize();if(!animationSteps){animationSteps=0}if(animationSteps>0){_resize(contentHeight,h,new Date().getTime(),animationSteps,me.onResize)}else{content.style.height=h+"px";me.onResize()}}};var _resize=function(start,end,lastTick,timeLeft,animationSteps,callback){var curTick=new Date().getTime();var elapsedTicks=curTick-lastTick;if(timeLeft<=elapsedTicks){content.style.height=end+"px";if(callback){callback.apply(me,[])}return}timeLeft-=elapsedTicks;var d=start-end;var percentComplete=1-(timeLeft/animationSteps);var offset=Math.round(percentComplete*d);content.style.height=start-offset+"px";setTimeout(function(){_resize(start,end,curTick,timeLeft,animationSteps,callback)},33)};var scrollTop=function(lastTick,timeLeft,animationSteps,callback){var curTick=new Date().getTime();var elapsedTicks=curTick-lastTick;if(timeLeft<=elapsedTicks){setScrollPosition(0);if(callback){callback.apply(me,[])}return}timeLeft-=elapsedTicks;var start=getScrollPosition();var d=start;var percentComplete=1-(timeLeft/animationSteps);var offset=Math.round(percentComplete*d);setScrollPosition(start-offset);setTimeout(function(){scrollTop(curTick,timeLeft,animationSteps,callback)},33)};var getScrollPosition=function(){return window.scrollY};var setScrollPosition=function(y){window.scrollTo(0,y)};this.setContentHeight=function(h){content.style.height=h};var highlight=function(el){var nodes=[];var pres=el.getElementsByTagName("pre");for(var i=0;i<pres.length;i++){var pre=pres[i];var addNode=true;var parentNode=pre.parentNode;while(parentNode!=null){if(parentNode.nodeName.toLowerCase()==="pre"){addNode=false;break}parentNode=parentNode.parentNode}if(addNode){nodes.push(pre)}}if(typeof CodeMirror!=="undefined"){for(var i=0;i<nodes.length;i++){var pre=nodes[i];var src=pre.innerText.replace(/\s+$/,"");var lang=pre.getAttribute("language");if(!lang&&pre.className){var idx=pre.className.indexOf("brush:");if(idx>-1){lang=pre.className.substring(idx+"brush:".length);idx=lang.indexOf(";");if(idx>-1){lang=lang.substring(0,idx)}lang=lang.replace(/^\s*/,"").replace(/\s*$/,"")}}if(!lang){lang="java"}if(lang=="js"){lang="javascript"}if(lang=="java"){lang="text/x-java"}var lineNumbers=pre.getAttribute("lineNumbers");if(lineNumbers==="true"){lineNumbers=true}else{lineNumbers=false}var numLines=src.split("\n").length;var initCodeMirror=function(pre,src,lang,lineNumbers,callback){var cm=CodeMirror(pre,{mode:lang,lineNumbers:lineNumbers,readOnly:true,value:src});cm.setSize("100%","100%");if(callback){callback.apply(this,[pre,cm])}};if(numLines<250){pre.innerHTML="";initCodeMirror(pre,src,lang,lineNumbers)}else{var h=parseFloat(pre.offsetHeight);var lineHeight=h/numLines;h+=lineHeight;pre.style.opacity=0;pre.innerHTML="";pre.style.height=h+"px";setTimeout(initCodeMirror,200,pre,src,lang,lineNumbers,function(pre){config.fx.fadeIn(pre,"easeInCubic",300)})}}}else{if(typeof SyntaxHighlighter!=="undefined"){var highlight=false;for(var i=0;i<nodes.length;i++){var pre=nodes[i];if(pre.className==""){pre.className="brush: java;"}highlight=true}if(highlight){SyntaxHighlighter.highlight()}}}};this.updateLinks=function(links){for(var i=0;i<links.length;i++){if(links[i].hostname==window.location.hostname){var onclick=function(e){var url=this.href;if(window.location==url){e.preventDefault();return}var tmp=url.substring(url.indexOf(this.pathname)+this.pathname.length);if(tmp.indexOf("#")==0){e.preventDefault();return}var path=getPath(this.pathname);var dir=getDir(path);if(me.updateLink(url,path,dir)){e.preventDefault();getHTML(url,function(html,title,inlineScripts){load(html,title,url,dir,inlineScripts)})}};links[i].onclick=onclick}}};var load=function(html,title,url,dir,inlineScripts){var tab=me.getTab(dir);if(!tab){return}var currPath=getPath(window.location.pathname);var currDir=getDir(currPath);var currTab=me.getTab(currDir);if(!nextPage){console.error("nextPage is null in load");return}if(!currPage){console.error("currPage is null in load");return}document.title=title;history.pushState(null,title,url);scrollUp=true;var slide=tab.dir!=currTab.dir;slide=true;if(!slide){currPage.innerHTML=html;updateContent(currPage)}else{nextPage.innerHTML=html;var a,b;for(var i=0;i<tabs.length;i++){var path=tabs[i].dir;if(path==currTab.dir){a=i}if(path==tab.dir){b=i}}log(a+" "+b);if(a==b){var path=getPath(window.location.pathname);if(path.indexOf(currPath)==0){b=1;a=0}else{log(currPath+" vs "+path)}}if(b>a){slideIndex++;carousel.next()}else{slideIndex--;carousel.back()}}loadInlineScripts(inlineScripts);var panelInfo={index:slideIndex,title:title};history.replaceState(panelInfo,title,url)};var loadInlineScripts=function(inlineScripts){for(var i=0;i<inlineScripts.length;i++){var script=inlineScripts[i].firstChild.nodeValue;eval(script)}};var dispatchEvent=function(name){var evt;try{evt=new Event(name)}catch(e){evt=document.createEvent("Event");evt.initEvent(name,false,false)}if(config.animationSteps>0){window.dispatchEvent(evt)}else{setTimeout(function(){window.dispatchEvent(evt)},50)}};me.getTabs=function(){return tabs};me.getTab=function(dir){for(var i=0;i<tabs.length;i++){if(tabs[i].dir==dir){return tabs[i]}}return null};this.updateLink=function(url,path,dir){if(dir=="downloads"||dir=="images"){var idx=path.lastIndexOf(".");if((path.length-idx)<5){return false}}return true};this.updateTabs=function(path){if(!path){path=getPath(window.location.pathname)}var currDir=getDir(path);var currTab=me.getTab(currDir);for(var i=0;i<tabs.length;i++){tabs[i].div.className=""}if(currTab){currTab.div.className="active"}};this.updateNav=function(path){if(!config.navbar){return}config.navbar.innerHTML="";if(!path){path=getPath(window.location.pathname)}if(path.lastIndexOf("/")===path.length-1){path=path.substring(0,path.length-1)}var arr=path.split("/");if(arr.length===0||arr[0]===""){config.navbar.style.height="0px"}else{config.navbar.style.height=""}for(var i=0;i<arr.length;i++){var div=document.createElement("div");div.innerText=arr[i].split("_").join(" ");if(i<arr.length-1){div.path=arr.slice(0,i+1).join("/");div.onclick=function(e){var path=this.path;var url=window.location.hostname+path;var dir=getDir(path);var url=window.location.origin;if(!url){url=window.location.protocol;if(url.indexOf(":")===-1){url+=":"}var host=window.location.host;url+="//"+host;var port=parseInt(window.location.port);if(!isNaN(port)){if(host.indexOf(":")===-1){url+=":"+port}}}url+="/"+path;if(me.updateLink(url,path,dir)){e.preventDefault();getHTML(url,function(html,title,inlineScripts){load(html,title,url,dir,inlineScripts)})}}}config.navbar.appendChild(div)}};this.updateSidebar=function(path){};var updateContent=function(el){highlight(el);var links=el.getElementsByTagName("a");me.updateLinks(links)};var getPath=function(path){if(path==null){path=""}else{if(path.indexOf("/")==0){if(path.length>1){path=path.substring(1)}else{path=""}}}return path};var getDir=function(path){var dir=path.toLowerCase();var idx=dir.indexOf("/");if(idx>0){dir=dir.substring(0,idx)}return dir};var getHTML=function(url,callback){url+="";if(url.indexOf("?")==-1){url+="?"}else{url+="&"}url+="template=false";pageLoader.load(url,function(html,title,inlineScripts){var contentWrapper=document.createElement("div");setStyle(contentWrapper,config.style.panel);contentWrapper.innerHTML=html;html=contentWrapper.outerHTML;if(title==null||title.length==0){var h1=contentWrapper.getElementsByTagName("h1");if(h1.length>0){title=h1[0].innerHTML}}contentWrapper=null;if(callback){callback.apply(me,[html,title,inlineScripts])}})};var getFirstChild=function(panel){for(var i=0;i<panel.childNodes.length;i++){var node=panel.childNodes[i];if(node.nodeType===1){return node}}return null};var log=function(str){if(debug){console.log(str)}};var _getRect=javaxt.dhtml.utils.getRect;var merge=javaxt.dhtml.utils.merge;var setStyle=javaxt.dhtml.utils.setStyle;init()};
if(!javaxt)var javaxt={};if(!javaxt.express)javaxt.express={};javaxt.express.UserPreferences=function(callback,scope){var me=this;var preferences={};this.refresh=function(callback,scope){get("UserPreferences?fields=key,value&format=json",{success:function(text){preferences={};JSON.parse(text).forEach((r)=>{preferences[r.key]=r.value;});if(!scope)scope=me;callback.apply(scope,[clone(preferences)]);},failure:function(){}});};this.get=function(key){var val=preferences[key.toLowerCase()];if(typeof val==='undefined')return null;if(isObject(val))return clone(val);else return val;};this.set=function(key,value,silent){key=key.toLowerCase().trim();if(preferences[key]===value)return;if(isObject(value))value=clone(value);if(silent===true){preferences[key]=value;}
else{var preference={key:key,value:value};post("UserPreference",JSON.stringify(preference),{success:function(){preferences[key]=value;},failure:function(){}});}};var isObject=function(value){return value!=null&&typeof value=='object'&&!Array.isArray(value);};var clone=function(json){return JSON.parse(JSON.stringify(json));};var post=javaxt.dhtml.utils.post;var get=javaxt.dhtml.utils.get;this.refresh(callback,scope);};
if(!javaxt)var javaxt={};if(!javaxt.express)javaxt.express={};javaxt.express.ActivityMeter=function(parent,config){var me=this;var defaultConfig={maxIdleTime:5*60*1000,lineGraph:{refeshRate:500},userChart:{}};var lineChart,pieChart;var requestsPerMinute={};var activeUsers={};var init=function(){config=merge(config,defaultConfig);if(!config.style)config.style=javaxt.dhtml.style.default;var div=createElement("div",parent,"user-stats");var table=createTable(div);var tr=table.addRow();createLineChart(tr.addColumn({width:"100%",height:"100%",padding:"20px"}));createDonutChart(tr.addColumn({padding:"20px",height:"100%"}));me.el=div;addShowHide(me);};this.notify=function(op,model,id,userID){var currTime=getCurrentTime();var numRequests=requestsPerMinute[currTime];requestsPerMinute[currTime]=!numRequests?1:numRequests+1;};this.clear=function(){if(lineChart){lineChart.stop();lineChart.clear();}
if(pieChart){pieChart.stop();pieChart.clear();}};this.update=function(_activeUsers){activeUsers=_activeUsers;if(lineChart)lineChart.start();if(pieChart)pieChart.start();};var createLineChart=function(parent){var div=createElement("div",parent,{width:"100%",height:"100%"});onRender(div,function(){var _chart=d3.select(div);const bb=_chart.node().getBoundingClientRect();const xScale=d3.scaleLinear().domain([0,100]).range([0,bb.width]);const yScale=d3.scaleLinear().domain([0,10]).range([bb.height,0]);var data=new Array(100).fill(0);lineChart=_chart.append('svg').attr('width','100%').attr('height','100%');const line=d3.line().curve(d3.curveBasis).x((_,i)=>xScale(i)).y((d)=>yScale(d));lineChart.append('path').attr('d',line(data)).style("stroke","#777").style("stroke-width",1).style("fill","none");lineChart.start=function(){lineChart.stop();lineChart.interval=setInterval(function(){var currTime=getCurrentTime();var numRequests=requestsPerMinute[currTime];if(!numRequests)numRequests=0;delete requestsPerMinute[currTime];data.pop();data.unshift(numRequests);var lineColor="#777";for(var i in data){if(data[i]>0){lineColor="#6699CC";break;}}
lineChart.selectAll('path').data([data]).attr('d',line).style("stroke",lineColor);},config.lineGraph.refeshRate);};lineChart.stop=function(){clearInterval(lineChart.interval);};lineChart.clear=function(){data=new Array(100).fill(0);lineChart.selectAll('path').data([data]).attr('d',line);};lineChart.start();});};var createDonutChart=function(parent){var div=createElement("div",parent,{width:"350px",height:"100%"});onRender(div,function(){var width=div.offsetWidth;var height=div.offsetHeight;var radius=Math.min(width,height)/2;var cutout=0.65;var innerRadius=radius*cutout;var arc=d3.arc().innerRadius(innerRadius).outerRadius(radius);pieChart=d3.select(div).append("svg").attr("width","100%").attr("height","100%").append("g").attr("transform","translate("+width/2+","+height/2+")");var pie=d3.pie().value(function(d){return d.value;});var label=pieChart.append("text").attr("text-anchor","middle").attr('font-size','4em').attr('y',20);var arcTween=function(a){var i=d3.interpolate(this._current,a);this._current=i(0);return function(t){return arc(i(t));};};var getData=function(){var data=[];for(var key in activeUsers){var lastUpdate=new Date(activeUsers[key]).getTime();var currTime=new Date().getTime();var elapsedTime=currTime-lastUpdate;if(true){data.push({key:key,value:config.maxIdleTime-elapsedTime});}}
return data;};var getColor=d3.scaleOrdinal(d3.schemeCategory10);var render=function(data){var numActiveUsers=Object.keys(data).length;label.text(numActiveUsers+"");if(numActiveUsers===0){data.push({key:"-1",value:1});}
var pieData=pie(data);pieChart.selectAll("path").data(pieData).transition().duration(100).attrTween("d",arcTween);pieChart.selectAll("path").data(pieData).enter().append("path").attr("d",arc).attr("fill",function(d,i){if(d.data.key==="-1")return"#dcdcdc";return getColor(d.data.key);}).style("opacity",0.8).each(function(d){this._current=d;});pieChart.selectAll("path").data(pieData).exit().remove();};pieChart.start=function(){pieChart.stop();pieChart.interval=setInterval(function(){var inactiveUsers=[];for(var key in activeUsers){var lastUpdate=activeUsers[key];var currTime=new Date().getTime();var elapsedTime=currTime-lastUpdate;if(elapsedTime>config.maxIdleTime){inactiveUsers.push(key);}}
for(var i in inactiveUsers){var userID=inactiveUsers[i];delete activeUsers[userID];}
render(getData());},1000);};pieChart.stop=function(){clearInterval(pieChart.interval);};pieChart.clear=function(){render([]);};pieChart.start();});};var getCurrentTime=function(){var d=new Date();return d.getUTCFullYear()+
pad(d.getUTCMonth()+1)+
pad(d.getUTCDate())+
pad(d.getUTCHours())+
pad(d.getUTCMinutes());};var pad=function(i){return(i<9?"0"+i:i+"");};var createElement=javaxt.dhtml.utils.createElement;var createTable=javaxt.dhtml.utils.createTable;var addShowHide=javaxt.dhtml.utils.addShowHide;var onRender=javaxt.dhtml.utils.onRender;var merge=javaxt.dhtml.utils.merge;init();};
var alert=function(a){javaxt.dhtml.utils.alert(a)};
var confirm=function(b,a){javaxt.dhtml.utils.confirm(b,a);return false};
if(!javaxt)var javaxt={};if(!javaxt.express)javaxt.express={};javaxt.express.DBView=function(parent,config){this.className="javaxt.express.DBView";var me=this;var defaultConfig={queryLanguage:"sql",queryService:"sql/job/",getTables:"sql/tables/",createJob:"sql/job/",cancelJob:"sql/job/{jobID}",getJob:"sql/job/{jobID}",pageSize:50,format:"json",style:{container:{width:"100%",height:"100%"},border:"1px solid #383b41",leftPanel:{backgroundColor:"#272a31",borderRight:"1px solid #383b41",color:"#bfc0c3"},rightPanel:{},bottomPanel:{backgroundColor:"#e4e4e4",borderTop:"1px solid #b5b5b5"},toolbar:"panel-toolbar",toolbarButton:{},toolbarIcons:{run:"run-icon",cancel:"stop-icon"},editor:{height:"240px",fontFamily:'"Consolas", "Bitstream Vera Sans Mono", "Courier New", Courier, monospace'},table:{},tree:{padding:"7px 0 7px 0px",backgroundColor:"",li:"tree-node"},error:{fontFamily:'"Consolas", "Bitstream Vera Sans Mono", "Courier New", Courier, monospace',color:"#6c6c6c",padding:"10px"}},onTreeClick:function(item){var tableName=item.name;if(item.node){var schema=item.node.schema;if(schema&&schema!=="public"){tableName=schema+"."+tableName;}}
editor.setValue("select * from "+tableName);}};var tree,toolbar,editor,grid,gridContainer,waitmask;var runButton,cancelButton;var jobID;var border;var init=function(){if(typeof parent==="string"){parent=document.getElementById(parent);}
if(!parent)return;config=clone(config);config=merge(config,defaultConfig);waitmask=config.waitmask;border=config.border;var div=createElement('div',parent,config.style.container);div.classList.add('javaxt-db-view');me.el=div;addShowHide(me);var table=createTable(div);var tr=table.addRow();var td=tr.addColumn(config.style.leftPanel);td.style.height="100%";var target=createTableView(td);var td=tr.addColumn(config.style.rightPanel);td.style.width="100%";td.style.height="100%";var hr=addHorizontalResizer(td,target);createQueryView(hr);onRender(me.el,function(){if(waitmask)waitmask.show(500);var getTables=config.getTables;if(typeof getTables==="string"){get(getTables,{success:function(text){if(waitmask)waitmask.hide();var tables=JSON.parse(text).tables;tree.addNodes(tables);},failure:function(request){if(waitmask)waitmask.hide();alert(request);}});}
else if(typeof getTables==="function"){getTables.apply(me,[tree]);}});};this.setQuery=function(query){if(query){if(query===editor.getValue()){}
else{editor.setValue(query);me.clearResults();}}
else{me.clear();}};this.getQuery=function(){return editor.getValue();};this.executeQuery=function(){cancel();if(waitmask)waitmask.show(500);me.clearResults();grid=null;var payload={query:editor.getValue(),limit:config.pageSize,format:config.format};getResponse(payload,function(request){cancelButton.disable();var data=parseResponse(request.responseText);render(data.records,data.columns);if(waitmask)waitmask.hide();});};this.clear=function(){editor.setValue("");me.clearResults();};this.clearResults=function(){if(grid){try{grid.clear();destroy(grid);}
catch(e){}}
gridContainer.innerHTML="";};this.getComponents=function(){return{tree:tree,grid:grid,editor:editor,toolbar:toolbar};};var createTableView=function(parent){var outerDiv=createElement("div",parent,{position:"relative",height:"100%",width:"210px",overflow:"auto"});var div=createElement("div",outerDiv,{position:"absolute",width:"100%"});tree=new javaxt.dhtml.Tree(div,{style:config.style.tree});tree.onClick=function(item){config.onTreeClick.apply(me,[item]);};return outerDiv;};var createQueryView=function(parent){var panel=new javaxt.dhtml.Panel(parent,{style:{toolbar:config.style.toolbar}});toolbar=panel.getToolbar();addButtons(toolbar);var table=createTable(panel.getBody());var td=table.addRow().addColumn(config.style.editor);td.style.borderBottom=border;var target=td;if(typeof CodeMirror!=='undefined'){var outerDiv=createElement("div",td,{height:"100%",position:"relative"});var innerDiv=createElement("div",outerDiv,{width:"100%",height:"100%",position:"absolute",overflow:"hidden",overflowX:"auto"});editor=CodeMirror(innerDiv,{value:"",mode:config.queryLanguage,lineNumbers:true,indentUnit:4});td.childNodes[0].style.height="100%";editor.setValue=function(str){var doc=this.getDoc();doc.setValue(str);doc.clearHistory();var cm=this;setTimeout(function(){cm.refresh();},200);};editor.getValue=function(){return this.getDoc().getValue();};}
else{editor=createElement('textarea',td,{width:"100%",height:"100%",resize:"none",border:"0 none",padding:"10px",boxSizing:"border-box",fontFamily:"inherit",fontSize:"inherit"});editor.spellcheck=false;editor.getValue=function(){return this.value;};editor.setValue=function(str){this.value=str;};}
td=table.addRow().addColumn(config.style.bottomPanel);td.style.height="100%";td.style.verticalAlign="top";addVerticalResizer(td,target);gridContainer=createElement("div",td,{height:"100%"});};var addVerticalResizer=function(parent,target){var div=createElement("div",parent,{position:"relative"});var resizeHandle=createElement("div",div,{position:"absolute",width:"100%",height:"10px",top:"-5px",cursor:"ns-resize",zIndex:2});javaxt.dhtml.utils.initDrag(resizeHandle,{onDragStart:function(x,y){var div=this;div.yOffset=y;div.initialHeight=target.offsetHeight;},onDrag:function(x,y){var div=this;var top=(div.yOffset-y);var height=div.initialHeight-top;target.style.height=height+"px";},onDragEnd:function(){}});};var addHorizontalResizer=function(parent,target){var div=createElement("div",parent,{position:"relative",height:"100%"});var resizeHandle=createElement("div",div,{position:"absolute",height:"100%",width:"10px",left:"-5px",cursor:"ew-resize",zIndex:2});javaxt.dhtml.utils.initDrag(resizeHandle,{onDragStart:function(x,y){var div=this;div.xOffset=x;div.initialWidth=target.offsetWidth;},onDrag:function(x,y){var div=this;var left=(div.xOffset-x);var width=div.initialWidth-left;target.style.width=width+"px";},onDragEnd:function(){}});return div;};var addButtons=function(toolbar){runButton=createButton(toolbar,{label:"Run",icon:config.style.toolbarIcons.run,disabled:false});runButton.onClick=function(){me.executeQuery();};cancelButton=createButton(toolbar,{label:"Cancel",icon:config.style.toolbarIcons.cancel,disabled:true});cancelButton.onClick=function(){cancel(function(){if(waitmask)waitmask.hide();});};};var cancel=function(callback){if(jobID){var request;var requestConfig={success:function(){cancelButton.disable();if(callback)callback.apply(null,[]);},failure:function(request){cancelButton.disable();if(callback)callback.apply(null,[]);if(request.status!==404){showError(request);}}};var cancelJob=config.cancelJob;if(!cancelJob)cancelJob=config.queryService+jobID;if(typeof cancelJob==="string"){var url=cancelJob.replace("{jobID}",jobID);request=javaxt.dhtml.utils.delete(url,requestConfig);}
else if(typeof cancelJob==="function"){request=cancelJob.apply(me,[jobID,requestConfig]);}}
else{if(callback)callback.apply(null,[]);}
jobID=null;};var showError=function(msg){cancelButton.disable();if(msg&&msg.responseText){msg=(msg.responseText.length>0?msg.responseText:msg.statusText);}
if(msg)msg=msg.replaceAll("\n","<br>");gridContainer.innerHTML="";var outerDiv=createElement("div",gridContainer,{width:"100%",height:"100%",position:"relative",overflow:"auto"});var innerDiv=createElement("div",outerDiv,{width:"100%",height:"100%",position:"absolute"});var div=createElement("div",innerDiv,config.style.error);div.innerHTML=msg;if(waitmask)waitmask.hide();};var getResponse=function(payload,callback){var requestConfig={success:function(text){jobID=JSON.parse(text).job_id;cancelButton.enable();var timer;var checkStatus=function(){if(jobID){var request;var requestConfig={success:function(text){if(text==="pending"||text==="running"){timer=setTimeout(checkStatus,250);}
else{clearTimeout(timer);callback.apply(me,[request]);}},failure:function(response){clearTimeout(timer);showError(response);}};var getJob=config.getJob;if(!getJob)getJob=config.queryService+jobID;if(typeof getJob==="string"){var url=getJob.replace("{jobID}",jobID);request=get(url,requestConfig);}
else if(typeof getJob==="function"){request=getJob.apply(me,[jobID,requestConfig]);}}
else{clearTimeout(timer);}};timer=setTimeout(checkStatus,250);},failure:function(response){showError(response);}};var createJob=config.createJob;if(!createJob)createJob=config.queryService;if(typeof createJob==="string"){post(createJob,JSON.stringify(payload),requestConfig);}
else if(typeof createJob==="function"){createJob.apply(me,[payload,requestConfig]);}};var parseResponse=function(obj){var records=[];var columns=[];if(javaxt.dhtml.utils.isString(obj)){var s=obj.substring(0,1);if(s=="{"||s=="["){obj=JSON.parse(obj);}}
if(obj.cols&&obj.rows){records=obj.rows;columns=obj.cols;}
else{if(config.format==="json"){if(obj.rows){var rows=obj.rows;var record=rows[0];for(var key in record){if(record.hasOwnProperty(key)){columns.push(key);}}
for(var i=0;i<rows.length;i++){var record=[];var row=rows[i];for(var j=0;j<columns.length;j++){var key=columns[j];var val=row[key];record.push(val);}
records.push(record);}}}
else{}}
return{columns:columns,records:records};};var render=function(records,columns){if(!columns||columns.length===0){showError("No records");return;}
var outerDiv=createElement("div",gridContainer,{position:"relative",height:"100%"});var innerDiv=createElement("div",outerDiv,{position:"absolute",width:"100%",height:"100%",overflow:"hidden",overflowX:"auto"});var overflowDiv=createElement("div",innerDiv,{position:"absolute",width:"100%",height:"100%"});onRender(innerDiv,function(){var rect=javaxt.dhtml.utils.getRect(innerDiv);var widths=[];var minWidths=[];var headerWidth=0;var pixelsPerChar=10;if(columns.length>1){var arr=[];arr.push(columns);arr.push(...records);var o=getSuggestedColumnWidths(arr,pixelsPerChar,rect.width);widths=o.suggestedWidths;headerWidth=o.headerWidth;for(var i=0;i<columns.length;i++){var minWidth=columns[i].length*pixelsPerChar;if(minWidth<150)minWidth=150;minWidths.push(minWidth);}}
else{widths.push("100%");minWidths.push(null);}
var arr=[];for(var i=0;i<columns.length;i++){arr.push({header:columns[i],width:widths[i],minWidth:minWidths[i],sortable:false});}
if(rect.width<headerWidth){overflowDiv.style.width=headerWidth+"px";}
grid=new javaxt.dhtml.DataGrid(overflowDiv,{columns:arr,style:config.style.table,url:config.queryService,limit:config.pageSize,getResponse:function(url,payload,callback){payload={query:editor.getValue(),page:grid.getCurrPage(),limit:config.pageSize,format:config.format};getResponse(payload,callback);},parseResponse:function(request){return parseResponse(request.responseText).records;},update:function(row,record){for(var i=0;i<record.length;i++){var val=record[i];if(val===null||val===undefined){val="";}
else{if(val.constructor===arrayConstructor||val.constructor===objectConstructor){val=JSON.stringify(val);}}
row.set(i,val);}}});grid.beforeLoad=function(page){};grid.afterLoad=function(){cancelButton.disable();};grid.onSelectionChange=function(){};grid.getColumns=function(){return columns;};grid.getConfig=function(){return{columns:arr};};grid.load(records,1);});};var createButton=function(toolbar,btn){btn.style=JSON.parse(JSON.stringify(config.style.toolbarButton));if(btn.icon){btn.style.icon="toolbar-button-icon "+btn.icon;delete btn.icon;}
if(btn.menu===true){btn.style.arrow="toolbar-button-menu-icon";btn.style.menu="menu-panel";btn.style.select="panel-toolbar-menubutton-selected";}
return new javaxt.dhtml.Button(toolbar,btn);};var arrayConstructor=[].constructor;var objectConstructor=({}).constructor;var get=javaxt.dhtml.utils.get;var post=javaxt.dhtml.utils.post;var del=javaxt.dhtml.utils.delete;var clone=javaxt.dhtml.utils.clone;var merge=javaxt.dhtml.utils.merge;var destroy=javaxt.dhtml.utils.destroy;var onRender=javaxt.dhtml.utils.onRender;var addShowHide=javaxt.dhtml.utils.addShowHide;var createTable=javaxt.dhtml.utils.createTable;var createElement=javaxt.dhtml.utils.createElement;var getSuggestedColumnWidths=javaxt.dhtml.utils.getSuggestedColumnWidths;init();};
if(!javaxt){var javaxt={}}if(!javaxt.express){javaxt.express={}}javaxt.express.Facet=function(g,a){this.className="javaxt.express.Facet";var e=this;var c;var i=0;var b={title:"Title",style:{panel:{backgroundColor:"#e1f2ff",marginBottom:"8px"},header:{backgroundColor:"#b0d4f3",color:"#003a92",padding:"4px 8px"},body:{padding:"4px 8px"},label:{fontSize:"12px",color:"#3e3e3e",whiteSpace:"nowrap",cursor:"pointer",padding:"1px 0 0 5px"},checkbox:{width:"13px",height:"13px",border:"1px solid #cccccc",borderRadius:"3px",background:"#F6F6F6",cursor:"pointer",margin:"0px",color:"#2b2b2b"},checkmark:{content:"",display:"block",width:"4px",height:"7px",border:"solid #ffffff",borderWidth:"0 2px 2px 0",transform:"rotate(45deg)",margin:"1px 0 0 4px"}},sort:{field:"name",direction:"desc"}};var h=function(){if(typeof g==="string"){g=document.getElementById(g)}if(!g){return}a=f(a,b);if(!a.filter){a.filter={}}if(!a.key){a.key=a.title}var k=document.createElement("div");d(k,a.style.panel);var j=document.createElement("div");d(j,a.style.header);if(typeof a.title==="string"){j.innerHTML=a.title}else{j.appendChild(a.title)}k.appendChild(j);c=document.createElement("div");d(c,a.style.body);k.appendChild(c);g.appendChild(k)};this.onChange=function(){};this.getTitle=function(){return a.title};this.getKey=function(){return a.key};this.clear=function(){c.innerHTML=""};this.getBody=function(){return c};this.getNumOptions=function(){return i};this.update=function(m){e.clear();var k=a.getLabel;var n=a.key;var o=[];for(var x in m){if(m.hasOwnProperty(x)){o.push({label:x,count:m[x]})}}i=o.length;if(a.sort){var s=a.sort.field;var t=a.sort.direction;if(s=="name"){if(t==null){t="asc"}o.sort(function(B,A){var z=B.label.toLowerCase();var C=A.label.toLowerCase();if(t=="desc"){if(z<C){return 1}if(z>C){return -1}}else{if(z<C){return -1}if(z>C){return 1}}return 0})}else{if(s=="count"){if(t==null){t="desc"}o.sort(function(B,A){var z=B.count;var C=A.count;if(t=="desc"){if(z<C){return 1}if(z>C){return -1}}else{if(z<C){return -1}if(z>C){return 1}}return 0})}}}var m=o;for(var w=0;w<m.length;w++){var v=m[w];var q=v.count;var r=v.label;if(k){r=k(r)}var u=false;if(a.filter[n]){var o=a.filter[n].split(",");for(var l=0;l<o.length;l++){if(o[l]==v.label+""){u=true;break}}}var j=document.createElement("div");var p=new javaxt.dhtml.Checkbox(j,{label:r+" ("+q+")",value:v.label,checked:u,display:"table",style:{label:a.style.label,box:a.style.checkbox,check:a.style.checkmark}});p.filterName=n;p.onClick=function(C){var B=this.filterName;var F=this.getValue()+"";var E=a.filter[B];if(C){if(E){var A=true;var y=E.split(",");for(var z=0;z<y.length;z++){if(y[z]==F){A=false;break}}if(A){a.filter[B]+=","+F}}else{a.filter[B]=F}}else{if(E){var D="";var y=E.split(",");for(var z=0;z<y.length;z++){if(y[z]!=F){if(D.length>0){D+=","}D+=y[z]}}if(D.length>0){a.filter[B]=D}else{delete a.filter[B]}}}e.onChange(a.filter[B])};c.appendChild(j)}};var f=javaxt.dhtml.utils.merge;var d=javaxt.dhtml.utils.setStyle;h()};
if(!javaxt)var javaxt={};if(!javaxt.express)javaxt.express={};javaxt.express.FileBrowser=function(parent,config){this.className="javaxt.express.FileBrowser";var me=this;var defaultConfig={fileService:"files/",pageSize:300,foldersOnly:false,title:null,width:600,height:450,modal:true,closable:true,footer:null,columns:[{header:"Name",field:"name",width:"100%",sortable:true},{header:"Date",field:"date",width:"135px",align:"left",sortable:true},{header:"Type",field:"type",width:"100px",sortable:true},{header:"Size",field:"size",width:"80px",align:"right",sortable:true}],style:{window:{panel:"window",header:"window-header",button:"window-header-button",title:"window-title",body:{padding:"0px",verticalAlign:"top"}},toolbar:{panel:"panel-toolbar",button:{},icons:{back:"backIcon",forward:"nextIcon",up:"upIcon",refresh:"refreshIcon"},path:"form-input",pathItem:""},table:{},info:{height:"20px",lineHeight:"20px",padding:"0 5px"},leftPanel:{background:"#272a31",borderRight:"1px solid #383b41"},tree:{padding:"7px 0 7px 0px",backgroundColor:"",li:"tree-node"},centerPanel:{width:"100%",height:"100%"}},renderers:{iconRenderer:null,nameRenderer:null,dateRenderer:null,typeRenderer:null,sizeRenderer:null}};var grid,addressBar,waitmask;var button={};var params={};var history=[];var currDir;var pathSeparator="\\";var totalCount=0;var totalSize=0;var init=function(){if(typeof parent==="string"){parent=document.getElementById(parent);}
if(!parent)return;config=clone(config);config=merge(config,defaultConfig);var className="javaxt-file-browser";if(parent===document.body){var win=new javaxt.dhtml.Window(parent,{title:config.title,width:config.width,height:config.height,modal:config.modal,closable:config.closable,footer:config.footer,style:config.style.window});for(var m in win){if(typeof win[m]=="function"){if(me[m]==null)me[m]=win[m];}}
parent=win.getBody();parent.classList.add(className);className="";config.style.info={display:"none"};}
var panel=new javaxt.dhtml.Panel(parent,{className:className,style:{toolbar:config.style.toolbar.panel}});me.el=panel.el;addShowHide(me);createNavbar(panel.getToolbar());createGrid(panel.getBody());waitmask=new javaxt.express.WaitMask(me.el);};this.clear=function(){grid.clear();addressBar.clear();history=[];Object.keys(params).forEach((key)=>{delete params[key];});Object.values(button).forEach((button)=>{button.disable();});totalCount=0;totalSize=0;};this.refresh=function(){grid.refresh();};this.setSort=function(col,dir){var filter=grid.getFilter();if(!col)delete filter.orderby;else{if(!dir)dir="";filter.orderby=col+" "+dir;}
grid.setFilter(filter);};this.setDirectory=function(path){grid.clear();if(!path||path.length==0)path="";path=path.trim();var file;if(path.length>0){var s="/";if(path.indexOf("\\")>-1)s="\\";var idx=path.lastIndexOf(s);if(idx!==path.length-1){file=path.substring(idx+1);path=path.substring(0,idx+1);}}
if(path.length==0){button.up.disable();}
else{button.up.enable();}
params.path=path;params.hidden=false;params.foldersOnly=config.foldersOnly;grid.load();history.push(path);addressBar.update(path);};this.getDirectory=function(){var path=params.path;if(path&&path.length>0){var s="/";if(path.indexOf("\\")>-1)s="\\";if(path.substring(path.length-1)!=s)path+=s;}
return path;};this.onDirectoryChange=function(dir){};this.onClick=function(item,path,row,e){};this.onDoubleClick=function(item,path,row,e){};this.onSelectionChange=function(){};this.getSelectedItems=function(){var arr=grid.getSelectedRecords();for(var i=0;i<arr.length;i++){arr[i]=parseRecord(arr[i]);}
return arr;};this.getGrid=function(){return grid;};var createNavbar=function(parent){var td=parent;td.style.display="flex";td.style.flexDirection="row";td.style.alignItems="center";var backButton=createButton(td,{label:"",icon:config.style.toolbar.icons.back,disabled:true});backButton.onClick=function(){};var forwardButton=createButton(td,{label:"",icon:config.style.toolbar.icons.forward,disabled:true});forwardButton.onClick=function(){};var upButton=createButton(td,{label:"",icon:config.style.toolbar.icons.up,disabled:true});upButton.onClick=function(){if(!currDir)return;if(currDir.length===0)return;var str=getPath(currDir,true);var idx=str.lastIndexOf("/");var path=currDir.substring(0,idx+1);if(getPath(path).indexOf("/")>-1){me.setDirectory(path);}
else{me.setDirectory("");}};button.up=upButton;var div=createElement("div",td,config.style.toolbar.path);div.style.position="relative";div.style.width="100%";var outerDiv=createElement("div",div,{position:"absolute",width:"100%",height:"100%",overflow:"hidden",whiteSpace:"nowrap",top:0,left:0});var innerDiv=createElement("div",outerDiv,{position:"absolute",width:"100%",height:"100%",overflow:"hidden",whiteSpace:"nowrap",top:"-2px",left:0});addressBar={clear:function(){innerDiv.innerHTML="";},update:function(path){innerDiv.innerHTML="";path=getPath(path,true);if(path.length==0)return;var arr=path.split("/");for(var i=0;i<arr.length;i++){var div=createElement("div",innerDiv);setStyle(div,config.style.toolbar.pathItem);div.style.display="inline-block";div.innerHTML=arr[i]+pathSeparator;outerDiv.scrollLeft=innerDiv.clientWidth;div.onclick=function(){var path="";for(var i=0;i<innerDiv.childNodes.length;i++){var div=innerDiv.childNodes[i];path+=div.innerHTML;if(div==this)break;}
if(path!=getPath(currDir,true)){me.setDirectory(path);}};}}};var refreshButton=createButton(td,{label:"",icon:config.style.toolbar.icons.refresh,disabled:false});refreshButton.onClick=function(){grid.refresh();};};var createGrid=function(parent){var table=createTable(parent);var td;td=table.addRow().addColumn();setStyle(td,config.style.centerPanel);grid=new javaxt.dhtml.DataGrid(td,{columns:config.columns,style:config.style.table,url:config.fileService,limit:config.pageSize,params:params,post:true,parseResponse:function(request){var data=JSON.parse(request.responseText);currDir=data.dir;me.onDirectoryChange(me.getDirectory());pathSeparator=data.pathSeparator;totalCount=data.count;totalSize=data.size;return data.items;},update:function(row,record){var item=parseRecord(record);row.set("Name",getItem(item));row.set("Date",getDate(item));row.set("Type",getType(item));row.set("Size",getSize(item));}});td=table.addRow().addColumn();var info=createElement("div",td);setStyle(info,config.style.info);info.style.position="relative";info=createElement("div",info,{position:"absolute"});var countInfo=createElement("div",info);countInfo.style.display="inline-block";var sizeInfo=createElement("div",info);sizeInfo.style.display="inline-block";sizeInfo.style.marginLeft="7px";var clear=grid.clear;grid.clear=function(){countInfo.innerHTML="";sizeInfo.innerHTML="";clear();};grid.beforeLoad=function(page){waitmask.show(500);countInfo.innerHTML="";sizeInfo.innerHTML="";};grid.onLoad=function(){waitmask.hide();countInfo.innerHTML=totalCount+" items";if(totalSize>0)sizeInfo.innerHTML=formatSize(totalSize);};grid.onError=function(req){waitmask.hide();alert(req);};grid.onSelectionChange=function(){me.onSelectionChange();};grid.onRowClick=function(row,e){var item=parseRecord(row.record);var path;if(currDir)path=currDir+item.name;else path=item.name;if(item.type=="Folder"){var s="/";if(path.indexOf("\\")>-1)s="\\";var idx=path.lastIndexOf(s);if(idx!==path.length-1)path+=s;}
if(e.detail===2){me.onDoubleClick(item,path,row,e);}
else{me.onClick(item,path,row,e);}};};var parseRecord=function(record){return{name:record[0],type:record[1],date:new Date(record[2]),size:record[3]};};var getName=function(item){return render(item,'name',function(){return item.name;});};var getIcon=function(item){return render(item,'icon',function(){return null;});};var getItem=function(item){var name=getName(item);var icon=getIcon(item);if(icon){var outerDiv=createElement("div");var div=createElement("div",outerDiv);div.style.display="inline-block";setContent(icon,div);var div=createElement("div",outerDiv);div.style.display="inline-block";setContent(name,div);return outerDiv;}
else{return name;}};var setContent=function(content,el){if(content==null||typeof content==="undefined"){el.innerHTML="";}
else{if(typeof content==="string"||!isNaN(parseFloat(content))){el.innerHTML=content;}
else{el.innerHTML="";try{el.appendChild(content);}
catch(e){}}}};var getDate=function(item){return render(item,'date',function(){var date=item.date;if(item.type=="Drive"){return"";}
else{return formatDate(date);}});};var getSize=function(item){return render(item,'size',function(){var size=item.size;if(item.type=="Folder"||item.type=="Drive"){return"";}
else{return formatSize(size);}});};var getType=function(item){return render(item,'type',function(){return item.type;});};var formatSize=function(size){if(size>0){size=size/1024;if(size<=1)size="1 KB";else{size=size/1024;if(size<=1)size="1 MB";else{size=Math.round(size)+" MB";}}}
return size;};var formatDate=function(date){var hour=date.getHours();if(hour==0)hour=12;else{if(hour>12)hour=hour-12;}
var m=(date.getHours()<12)?"AM":"PM";var minutes=date.getMinutes();if(minutes<10)minutes="0"+minutes;return(date.getMonth()+1)+"/"+date.getDate()+"/"+date.getFullYear()+" "+hour+":"+minutes+" "+m;};var createThumbnails=function(parent){};var getPath=function(str,trim){str=str.replace(/\\/g,'/');if(trim===true){if(str.substring(str.length-1)==="/"){str=str.substring(0,str.length-1);}}
return str;};var render=function(item,renderer,fn){var key=renderer+"Renderer";if(config.renderers[key])return config.renderers[key](item);else return fn.call();};var createButton=function(toolbar,btn){btn.style=JSON.parse(JSON.stringify(config.style.toolbar.button));if(btn.icon){btn.style.icon="toolbar-button-icon "+btn.icon;delete btn.icon;}
return new javaxt.dhtml.Button(toolbar,btn);};var post=javaxt.dhtml.utils.post;var del=javaxt.dhtml.utils.delete;var clone=javaxt.dhtml.utils.clone;var merge=javaxt.dhtml.utils.merge;var setStyle=javaxt.dhtml.utils.setStyle;var createElement=javaxt.dhtml.utils.createElement;var createTable=javaxt.dhtml.utils.createTable;var addShowHide=javaxt.dhtml.utils.addShowHide;init();};
if(!javaxt){var javaxt={}}if(!javaxt.express){javaxt.express={}}javaxt.express.FileUploader=function(m,c){this.className="javaxt.express.FileUploader";var j=this;var h;var e={uploadService:"upload",maxUploads:1,title:"File Upload",width:600,height:450,modal:true,closable:true,footer:null,style:{panel:"window",header:"window-header",button:"window-header-button",title:"window-title",body:"window-body",uploadArea:{border:"2px dashed #bbb",borderRadius:"5px",padding:"25px",margin:"25px",textAlign:"center",fontSize:"20pt",fontWeight:"bold",color:"#bbb",backgroundColor:"#f8f8f8",height:"200px"},centerPanel:{width:"100%",height:"100%",background:"#fff"},table:{},info:{height:"20px"}},renderers:{}};var o=function(){if(typeof m==="string"){m=document.getElementById(m)}if(!m){return}c=i(c);c=k(c,e);var r=l();var q=r.firstChild;var s,t;s=document.createElement("tr");q.appendChild(s);t=document.createElement("td");s.appendChild(t);b(t);s=document.createElement("tr");q.appendChild(s);t=document.createElement("td");s.appendChild(t);c.body=r;h=new javaxt.dhtml.Window(m,c);for(var p in h){if(typeof h[p]=="function"){if(j[p]==null){j[p]=h[p]}}}j.el=h.el;j.el.addEventListener("dragover",f,false);j.el.addEventListener("drop",function(v){v.stopPropagation();v.preventDefault();var u=v.dataTransfer.files;j.upload(u)},false)};this.accept=function(p){return true};this.upload=function(v){var r=[];for(var u=0;u<v.length;u++){var t=v[u];if(j.accept(t)===true){r.push(t)}}var q=0;var p=r.length;var s=function(){if(r.length==0){return}var w=r.shift();var x=new FormData();x.append(w.name,w);n(c.uploadService,x,{success:function(y){q++;s()},failure:function(y){q++;s()}})};s()};var b=function(q){var t=document.createElement("div");g(t,c.style.uploadArea);q.appendChild(t);var p=document.createElement("input");p.type="file";p.style.display="none";p.onchange=function(){j.upload(this.files)};t.appendChild(p);var s=document.createElement("span");s.innerHTML="Drag and drop files or ";t.appendChild(s);var r=document.createElement("a");r.href="#";r.innerHTML="browse";r.onclick=function(u){u.preventDefault();p.click()};t.appendChild(r)};var f=function(p){p.stopPropagation();p.preventDefault();p.dataTransfer.dropEffect="copy"};var a=function(q){var r=l();var p=r.firstChild;var s,t;s=document.createElement("tr");p.appendChild(s);t=document.createElement("td");s.appendChild(t);createNav(t);t=document.createElement("td");t.style.width="100%";s.appendChild(t);createGrid(t);q.appendChild(r)};var d=function(q,p){if(q==null||typeof q==="undefined"){p.innerHTML=""}else{if(typeof q==="string"||!isNaN(parseFloat(q))){p.innerHTML=q}else{p.innerHTML="";try{p.appendChild(q)}catch(r){}}}};var n=javaxt.dhtml.utils.post;var i=javaxt.dhtml.utils.clone;var k=javaxt.dhtml.utils.merge;var g=javaxt.dhtml.utils.setStyle;var l=javaxt.dhtml.utils.createTable;o()};
if(!javaxt)var javaxt={};if(!javaxt.express)javaxt.express={};javaxt.express.SearchField=function(parent,config){this.className="javaxt.express.SearchField";var me=this;var defaultStyle={};if(javaxt.dhtml.style){if(javaxt.dhtml.style.default){var style=javaxt.dhtml.style.default.combobox;if(style)defaultStyle=style;}}
var defaultConfig={url:'/search',searchDelay:500,style:defaultStyle,onButtonClick:function(){},debugr:null};var input;var socket;var socketStatus=0;var init=function(){if(typeof parent==="string"){parent=document.getElementById(parent);}
if(!parent)return;var clone={};merge(clone,config);merge(clone,defaultConfig);config=clone;for(var key in config){if(config.hasOwnProperty(key)){if(typeof config[key]=="function"){if(me[key]&&typeof me[key]=="function"){me[key]=config[key];}}}}
input=new javaxt.dhtml.ComboBox(parent,{maxVisibleRows:6,showMenuOnFocus:false,style:config.style});input.filter=function(){};input.getButton().onclick=config.onButtonClick;var timer;input.onChange=function(label,value){if(value)me.onSelect();if(timer)clearTimeout(timer);timer=setTimeout(function(){if(!value)search();},config.searchDelay);};var el=me.el=input.el;el.addEventListener("focusout",function(){if(timer)clearTimeout(timer);if(socket)socket.close();socketStatus=0;});};this.getValue=function(){return input.getValue();};this.setValue=function(value,silent){input.setValue(value,silent);};this.onSelect=function(){};this.clear=function(){input.clear();};this.getInput=function(){return input.getInput();};this.createFilter=function(text){return text;};this.parseResponse=function(text){return[];};var sendQuery=function(){log("sendQuery");var text=input.getText().trim();if(text.length===0)return;var filter=me.createFilter(text);if(filter)socket.send(filter);};var search=function(){log("search");input.removeAll();if(!socket||socketStatus===0){openSocket();}
else{if(socketStatus===3){sendQuery();}}};var openSocket=function(){socketStatus=1;var protocol=window.location.protocol.toLowerCase();if(protocol.indexOf("https")===0)protocol="wss";else protocol="ws";var url=protocol+'://'+window.location.host;if(config.url.indexOf("/")!=0)url+="/";url+=config.url;log(url);socket=new WebSocket(url);socket.onopen=function(event){log("onopen");socketStatus=2;};socket.onclose=function(event){log("onclose",event.code,event.reason);socketStatus=0;};socket.onerror=function(error){log("onerror");};socket.onmessage=function(event){var text=event.data;log(text);if(text==="Ready!"){socketStatus=3;sendQuery();}
else{var arr=config.parseResponse(text);try{arr.forEach((entry)=>{if(isArray(entry)){var label=entry[0];var value=entry[1];input.add(label,value);}});var options=input.getOptions();log(options);if(options.length>0){input.showMenu();}}
catch(e){}}};};var log=function(msg){var debugr=config.debugr;if(debugr&&debugr.append){debugr.append(msg);}};var merge=javaxt.dhtml.utils.merge;var isArray=javaxt.dhtml.utils.isArray;init();};
if(!javaxt){var javaxt={}}if(!javaxt.express){javaxt.express={}}javaxt.express.Spinner=function(c,b){var d=this;var a={style:"spinner",size:"25px",lineWidth:6};var e=function(){if(typeof c==="string"){c=document.getElementById(c)}if(!c){return}var k={};f(k,b);f(k,a);b=k;b.size=parseInt(b.size)+"px";b.lineWidth=parseInt(b.lineWidth)+"";var j=document.createElement("div");j.className=b.style;j.style.width=b.size;j.style.height=b.size;j.style.display="inline-block";var h="http://www.w3.org/2000/svg";var g=document.createElementNS(h,"svg");g.setAttribute("width",b.size);g.setAttribute("height",b.size);g.setAttribute("viewBox","0 0 66 66");j.appendChild(g);var i=document.createElementNS(h,"circle");i.setAttribute("fill","none");i.setAttribute("stroke-width",b.lineWidth);i.setAttribute("stroke-linecap","round");i.setAttribute("cx","33");i.setAttribute("cy","33");i.setAttribute("r","30");g.appendChild(i);c.appendChild(j);d.el=j};this.show=function(){setTimeout(function(){d.el.style.display="";d.el.style.opacity=1;d.el.childNodes[0].style.opacity=1},50)};this.hide=function(){d.el.style.opacity=0;d.el.childNodes[0].style.opacity=0;setTimeout(function(){d.el.style.display="none"},500)};var f=javaxt.dhtml.utils.merge;e()};
if(!javaxt){var javaxt={}}if(!javaxt.express){javaxt.express={}}javaxt.express.ThumbnailEditor=function(k,y){var z=this;var l={thumbnailWidth:400,thumbnailHeight:400,mask:"circle",sliders:true,readOnly:false,style:{backgroundColor:"#000",uploadArea:{},toolbar:{padding:"10px 7px 0px"},slider:{groove:{},handle:{}}}};var A;var x=0;var r=0;var o=0;var j=0;var b,t;var v;var s;var w=function(){if(typeof k==="string"){k=document.getElementById(k)}if(!k){return}var E={};h(E,y);h(E,l);y=E;y.thumbnailWidth=parseInt(y.thumbnailWidth);if(isNaN(y.thumbnailWidth)){y.thumbnailWidth=l.thumbnailWidth}y.thumbnailHeight=parseInt(y.thumbnailHeight);if(isNaN(y.thumbnailHeight)){y.thumbnailHeight=l.thumbnailHeight}y.readOnly=(y.readOnly===true);var D=q("div",k,{display:"inline-block"});z.el=D;var B=e(D);var C=B.addRow().addColumn({height:"100%",backgroundColor:y.style.backgroundColor});a(C);if(y.sliders!==false){g(B.addRow().addColumn())}};this.onChange=function(){};this.setImage=function(B){if(!B){return}A.style.width="";A.style.height="";if(b){t.clearRect(0,0,b.width,b.height)}A.src=B;A.parentNode.className=""};this.getImage=function(L,J){if(!L){L="png"}if(L==="jpg"){L="jpeg"}var C=x/parseFloat(A.style.width);var N=r/parseFloat(A.style.height);var F=-parseFloat(A.style.left)*C;var K=-parseFloat(A.style.top)*N;var D=y.thumbnailWidth*C;var M=y.thumbnailHeight*N;try{var B=t.getImageData(F,K,D,M);var E=q("canvas");E.width=D;E.height=M;E.getContext("2d").putImageData(B,0,0);n(E,y.thumbnailWidth,y.thumbnailHeight,true);var I="image/"+L;var G=E.toDataURL(I);if(J===true){return G}G=G.substring(("data:"+I+";base64,").length);return i(G,I)}catch(H){return null}};var a=function(J){var B=q("div",J,y.style.uploadArea);B.style.width=y.thumbnailWidth+"px";B.style.height=y.thumbnailHeight+"px";B.style.position="relative";B.style.overflow="hidden";B.addEventListener("dragover",function(L){L.stopPropagation();L.preventDefault();L.dataTransfer.dropEffect="copy";B.style.opacity="0.9"},false);B.addEventListener("drop",function(O){O.stopPropagation();O.preventDefault();B.style.opacity="";A.style.width="";A.style.height="";if(b){t.clearRect(0,0,b.width,b.height)}z.onChange();var N=O.dataTransfer.files;var M=N[0];if(M.type.match("image.*")){var L=new FileReader();L.onload=(function(P){return function(Q){var R=Q.target.result;A.src=R;B.className=""}})(M);L.readAsDataURL(M)}},false);A=q("img",B);A.style.position="absolute";A.style.top=0;A.style.left=0;c(A);A.hide();A.onload=function(){A.style.top=0;A.style.left=0;x=A.width;r=A.height;o=A.width;j=A.height;f();v.show();if(!y.readOnly){v.style.cursor="grab"}if(!b){b=q("canvas");t=b.getContext("2d")}b.width=x;b.height=r;t.drawImage(A,0,0);A.show();if(s){s.setValue(0,true);s.enable()}z.onChange()};v=q("canvas",B);v.style.position="absolute";v.style.top=0;v.style.left=0;v.width=y.thumbnailWidth;v.height=y.thumbnailHeight;c(v);v.hide();if(y.mask==="circle"){var C=v.getContext("2d");C.fillStyle="rgba(0, 0, 0, 0.3)";C.fillRect(0,0,y.thumbnailWidth,y.thumbnailHeight);var F=y.thumbnailWidth/2;var E=y.thumbnailHeight/2;var H=Math.min(y.thumbnailWidth,y.thumbnailHeight)/2;C.beginPath();C.fillStyle="rgba(0, 0, 0, 1)";C.globalCompositeOperation="destination-out";C.arc(F,E,H,0,Math.PI*2);C.fill();C.globalCompositeOperation="source-over"}var K=0;var G=0;var I=0;var D=0;u(v,{onDragStart:function(L,M){if(y.readOnly){return}v.style.cursor="grabbing";I=parseInt(A.style.left);D=parseInt(A.style.top);K=L;G=M},onDrag:function(L,M){if(y.readOnly){return}A.style.left=I+(L-K)+"px";A.style.top=D+(M-G)+"px"},onDragEnd:function(){if(y.readOnly){return}v.style.cursor="grab";z.onChange()}})};var g=function(B){var D=q("div",B);d(D,y.style.toolbar);s=new javaxt.dhtml.Slider(D,{units:"percent",value:0,disabled:true,style:y.style.slider});var C;s.onChange=function(){if(C){cancelTimeout(C)}var G=s.getValue()/100;var F=o+((x-o)*G);var E=j+((r-j)*G);F=Math.min(Math.round(F),x);E=Math.min(Math.round(E),r);A.style.width=F+"px";A.style.height=E+"px";setTimeout(function(){z.onChange()},200)}};var f=function(){var C=function(){var D=y.thumbnailWidth/o;o=o*D;j=j*D};var B=function(){var D=y.thumbnailHeight/j;o=o*D;j=j*D};if(y.thumbnailHeight<y.thumbnailWidth){B();if(o>y.thumbnailWidth){C()}}else{C();if(j>y.thumbnailHeight){B()}}A.style.width=o+"px";A.style.height=j+"px"};var n=function(J,B,E,ac){var am=J.width;var ab=J.height;B=Math.round(B);E=Math.round(E);var Y=am/B;var af=ab/E;var F=Math.ceil(Y/2);var T=Math.ceil(af/2);var W=J.getContext("2d");var K=W.getImageData(0,0,am,ab);var S=W.createImageData(B,E);var al=K.data;var ah=S.data;for(var aj=0;aj<E;aj++){for(var ak=0;ak<B;ak++){var Q=(ak+aj*B)*4;var ag=0;var ai=0;var aa=0;var L=0;var P=0;var U=0;var V=0;var C=(aj+0.5)*af;var O=Math.floor(aj*af);var I=Math.ceil((aj+1)*af);for(var N=O;N<I;N++){var G=Math.abs(C-(N+0.5))/T;var D=(ak+0.5)*Y;var ad=G*G;var M=Math.floor(ak*Y);var Z=Math.ceil((ak+1)*Y);for(var X=M;X<Z;X++){var H=Math.abs(D-(X+0.5))/F;var ae=Math.sqrt(ad+H*H);if(ae>=1){continue}ag=2*ae*ae*ae-3*ae*ae+1;var R=4*(X+N*am);V+=ag*al[R+3];aa+=ag;if(al[R+3]<255){ag=ag*al[R+3]/250}L+=ag*al[R];P+=ag*al[R+1];U+=ag*al[R+2];ai+=ag}}ah[Q]=L/ai;ah[Q+1]=P/ai;ah[Q+2]=U/ai;ah[Q+3]=V/aa}}if(ac===true){J.width=B;J.height=E}else{W.clearRect(0,0,am,ab)}W.putImageData(S,0,0)};var i=function(H,C){C=C||"";var E=1024;var D=window.atob(H);var K=[];for(var F=0,I=D.length;F<I;F+=E){var L=D.slice(F,F+E);var J=new Array(L.length);for(var G=0;G<L.length;G++){J[G]=L.charCodeAt(G)}var B=new Uint8Array(J);K.push(B)}return new Blob(K,{type:C})};var h=javaxt.dhtml.utils.merge;var d=javaxt.dhtml.utils.setStyle;var q=javaxt.dhtml.utils.createElement;var e=javaxt.dhtml.utils.createTable;var c=javaxt.dhtml.utils.addShowHide;var m=javaxt.dhtml.utils.isNumber;var u=javaxt.dhtml.utils.initDrag;var p=javaxt.dhtml.utils.getRect;w()};
if(!javaxt){var javaxt={}}if(!javaxt.express){javaxt.express={}}javaxt.express.WaitMask=function(l,e){var i=this;var g,m;var c,d;var h=false;var f={style:{mask:"waitmask",spinner:{size:"50px",lineWidth:3}}};var n=function(){if(typeof l==="string"){l=document.getElementById(l)}if(!l){return}var o={};j(o,e);j(o,f);e=o;g=document.createElement("div");g.className=e.style.mask;g.style.opacity=0;b(g);g.hide();l.appendChild(g);i.el=g};this.show=function(o){if(h){return}o=parseInt(o);if(c){clearTimeout(c)}if(!isNaN(o)&&o>0){c=setTimeout(k,o)}else{k()}};var k=function(){g.style.zIndex=a();g.show();g.style.opacity="";g.innerHTML="";m=new javaxt.express.Spinner(g,e.style.spinner);m.show();h=true};this.hide=function(){if(c){clearTimeout(c)}g.style.zIndex="";g.style.opacity=0;d=setTimeout(function(){g.hide();g.innerHTML="";h=false},1500)};var j=javaxt.dhtml.utils.merge;var b=javaxt.dhtml.utils.addShowHide;var a=javaxt.dhtml.utils.getNextHighestZindex;n()};